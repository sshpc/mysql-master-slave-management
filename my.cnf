[client]
default-character-set = utf8mb4      # 客户端默认字符集
#connect_timeout = 10                 # 连接超时时间（秒）

[mysql]
default-character-set = utf8mb4      # 客户端字符集
#auto-vertical-output = 1             # 当结果过宽时自动垂直显示

[mysqld]
# SQL模式与安全配置 禁止零除，禁止自动创建用户
sql-mode = "ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION"
max_allowed_packet = 64M             # 允许的最大数据包大小

# 基础配置
port = 3306                          # 监听端口
#datadir = /var/lib/mysql             # 数据存储目录
#socket = /var/run/mysqld/mysqld.sock # 套接字文件路径
#user = mysql                         # 运行MySQL的系统用户
default-storage-engine = InnoDB      # 默认存储引擎（推荐InnoDB而非MyISAM）
skip-external-locking = on           # 禁用外部锁定，提高性能

# 字符集配置
character-set-server = utf8mb4       # 服务器默认字符集
collation-server = utf8mb4_unicode_ci # 服务器默认排序规则
init_connect = 'SET NAMES utf8mb4'   # 初始化连接时设置字符集

# 连接与超时配置

max_user_connections = 500           # 单个用户最大连接数
wait_timeout = 240                   # 非交互连接超时时间（秒）
interactive_timeout = 240            # 交互连接超时时间（秒）
connect_timeout = 10                 # 连接建立超时时间（秒）
back_log = 500                       # 连接队列大小，当连接数达max_connections时

# InnoDB 引擎配置

innodb_log_buffer_size = 8M         # 日志缓冲区大小,默认8M,写入频繁的OLTP系统可调大(16M-64M)，避免频繁写盘
innodb_log_file_size = 256M          # 单个日志文件大小
innodb_log_files_in_group = 2        # 日志文件组数量（通常为2）（TPS < 1 万）
innodb_flush_log_at_trx_commit = 1   # 事务日志刷盘策略
innodb_flush_method = O_DIRECT       # 绕过操作系统缓存，直接写入磁盘                                     
innodb_lock_wait_timeout = 120       # 行锁等待超时时间（秒）（默认50，120更适合高并发）
innodb_file_per_table = on           # 每个表使用独立表空间
innodb_stats_on_metadata = off       # 关闭元数据统计更新，提高性能

# MyISAM 引擎配置（如不使用可注释）
myisam_max_sort_file_size = 64G      # MyISAM最大临时文件 不超过可用磁盘空间的 50%

# 日志配置
log_error = /var/log/mysql/error.log # 错误日志路径
log_error_verbosity = 1              # 错误日志详细程度（1=错误，2=错误+警告，3=全部）

# 慢查询日志
slow_query_log = on                  # 开启慢查询日志
long_query_time = 5                  # 慢查询阈值（秒）
slow_query_log_file = /var/log/mysql/slow.log # 慢查询日志路径

#log_queries_not_using_indexes = on   # 记录未使用索引的查询
#log_slow_admin_statements = on       # 记录慢管理语句（如ALTER TABLE）

# 二进制日志（主从复制）配置
log-bin = mysql-bin                  # 开启二进制日志
binlog_format = mixed                # 二进制日志格式（mixed=混合模式）
expire_logs_days = 30                # 二进制日志保留天数
max_binlog_size = 1G                 # 单个二进制日志最大大小
sync_binlog = 5                      # 每执行5个事务同步一次二进制日志 # 1=最安全（每次事务都同步）；0=性能最好（由操作系统决定）


#常用配置
server_id = 101                      # 服务器唯一ID，主从复制必填
max_connections = 500               # 最大并发连接数


innodb_buffer_pool_size = 1G         # InnoDB缓存池大小（推荐设置为物理内存的 50%-70%）
innodb_buffer_pool_instances = 1     # 缓存池实例数量，建议与CPU核心数相同
innodb_read_io_threads = 4           # 读IO线程数  建议与CPU核心数接近
innodb_write_io_threads = 4          # 写IO线程数  建议与CPU核心数接近
key_buffer_size = 1GB                # MyISAM索引缓存大小 总内存的 10%-50%
myisam_sort_buffer_size = 32M        # MyISAM排序缓存大小 内存8G 64M-128M

table_open_cache = 512              # 表缓存数量
table_definition_cache = 1024        # 表定义缓存数量
thread_cache_size = 64               # 线程缓存大小
max_heap_table_size = 256M           # 内存临时表最大大小
tmp_table_size = 256M                # 临时表最大大小（与max_heap_table_size取最小值）
join_buffer_size = 8M                # 连接缓存大小
sort_buffer_size = 4M                # 排序缓存大小
read_buffer_size = 2M                # 顺序读缓存大小
read_rnd_buffer_size = 8M            # 随机读缓存大小

binlog-ignore-db = mysql             # 不同步mysql系统库
binlog-ignore-db = information_schema # 不同步系统信息库
# binlog-do-db = game                # 只同步指定数据库（取消注释并修改数据库名）